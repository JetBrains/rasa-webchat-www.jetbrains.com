<!DOCTYPE html>
<html lang="en">

<head>
  <title>Botfront - Web Chat</title>
  <script>
    // Token validation helper (simplified version from auth-utils)
    const isTokenValid = (token) => {
      if (!token) return false;
      try {
        const payload = token.split('.')[1];
        if (!payload) return false;
        const decoded = JSON.parse(atob(payload.replace(/-/g, '+').replace(/_/g, '/')));
        const now = Date.now() / 1000;
        return decoded.exp && decoded.exp > now;
      } catch (e) {
        return false;
      }
    };

    const load = () => {
      if (!WebChat) setTimeout(load, 100);
      if (WebChat) {
        const token = localStorage.getItem('chat_token');
        const hasValidToken = isTokenValid(token);

        console.log('üîç Token check:', hasValidToken ? 'Valid token found' : 'No valid token');

        WebChat.default({
          customData: {
            language: "en",
            ...(hasValidToken && { auth_header: token })
          },
          socketUrl: "https://rasa-stage-jb.labs.jb.gg",
          // –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—è –≤—ñ–¥—Ä–∞–∑—É —è–∫—â–æ —î —Ç–æ–∫–µ–Ω, —ñ–Ω–∞–∫—à–µ —á–µ–∫–∞—î–º–æ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è
          connectOn: hasValidToken ? 'mount' : 'open',
          // –ü–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–∂–µ—Ç —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î —Ç–æ–∫–µ–Ω –∞–±–æ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ
          hideWhenNotConnected: !hasValidToken,
          // Rules –ø—Ä–∞—Ü—é—é—Ç—å —Ç—ñ–ª—å–∫–∏ –∑ connectOn: 'mount'
          withRules: hasValidToken,
        });
      }
    }
    setTimeout(load, 200);
  </script>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<body style="background: black;">
  <!-- <body style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/4/42/Main_menu_of_Wikipedia.png);"> -->
  <a href="#" onclick="WebChat.send('/chitchat.greet')">Send chitchat.greet without text</a>
  <br />
  <a href="#" onclick="WebChat.send('/chitchat.greet', 'salut')">Send chitchat.greet with text</a>
  <span style="height: 400px; display: block;">test</span>
  <span style="height: 400px; display: block;">test</span>
  <span style="height: 400px; display: block;">test</span>
  <h1 class="test"> test</h1>
  <button class="my-button" style="margin-left: 450px"> MY BUTTON</button>
  <script src="index.js" type="text/javascript"></script>
  <div style="width: 400px; height: 2000px; border: 3px solid lightsalmon;" id="webchat" />
</body>

</html>