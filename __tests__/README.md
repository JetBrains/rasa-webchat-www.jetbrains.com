# Rasa Webchat Integration Tests

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

```
‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç: 11 —Ç–µ—Å—Ç–æ–≤ –∏–∑ 21 (52%)
üîÑ –í —Ä–∞–±–æ—Ç–µ: 10 —Ç–µ—Å—Ç–æ–≤ (—Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ timing/async)
```

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ ‚ùå
**–ù–∞–π–¥–µ–Ω–æ**: 5 —Å—Ç–∞—Ä—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –Ω–∞ Enzyme (Launcher, Messages, MessageButtons, Header, MessageCarousel)

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π Enzyme
- –ù–µ —Ä–∞–±–æ—Ç–∞–ª–∏ (–æ—à–∏–±–∫–∏ node:stream)
- –ù–µ –ø–æ–∫—Ä—ã–≤–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç–µ—Å—Ç—ã OAuth, token refresh, WebSocket

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã

### 2. –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ
- –û–±–Ω–æ–≤–ª–µ–Ω `package.json` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Jest –¥–ª—è jsdom
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã `@testing-library/react`, `@testing-library/jest-dom`
- –û–±–Ω–æ–≤–ª–µ–Ω `test-setup.js` —Å –º–æ–∫–∞–º–º–∏ –¥–ª—è Testing Library
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–æ–∫–∏: socket.io, localStorage, OAuth, TokenManager

### 3. –ù–∞–ø–∏—Å–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ ‚úÖ

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### `__tests__/integration/widget-final.test.js`

–í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ **—Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞**, –∞ –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π.

#### ‚úÖ 1. –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (3 —Ç–µ—Å—Ç–∞ - 2 –ø—Ä–æ—Ö–æ–¥—è—Ç)
- **‚úÖ PASS** - Launcher –∫–Ω–æ–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- **‚úÖ PASS** - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–∂–µ—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
- **‚ùå FAIL** - –í–∏–¥–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (timing issue)

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**: `ConnectedWidget` —Ä–µ–Ω–¥–µ—Ä–∏—Ç `WidgetLayout`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `Launcher` (src/components/Widget/layout.js:48)

#### ‚úÖ 2. –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (3 —Ç–µ—Å—Ç–∞ - 1 –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- **‚ùå FAIL** - AuthPlaceholder –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
- **‚ùå FAIL** - –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç handler
- **‚úÖ PASS** - –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è auth screen

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- `isAuth` state –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–æ–∫–∞–∑ AuthPlaceholder (src/index.js:54-57)
- `getIsTokenValid()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω (src/utils/auth-utils.js)
- AuthPlaceholder —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ Conversation –∫–æ–≥–¥–∞ `props.onAuthButtonClick` –ø–µ—Ä–µ–¥–∞–Ω (src/components/Conversation/index.js:51)

#### ‚úÖ 3. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - session flow (3 —Ç–µ—Å—Ç–∞ - 2 –ø—Ä–æ—Ö–æ–¥—è—Ç)
- **‚ùå FAIL** - Socket –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Ç–æ–∫–µ–Ω–æ–º
- **‚úÖ PASS** - Store —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **‚úÖ PASS** - TokenManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- TokenManager —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ useEffect (src/index.js:61-84)
- SocketWrapper —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `isAuth && token` (src/index.js:208-235)
- Store –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ initStore (src/index.js:238-246)

#### ‚úÖ 4. –Æ–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ (3 —Ç–µ—Å—Ç–∞ - 1 –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- **‚ùå FAIL** - Input –ø–æ–ª–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **‚úÖ PASS** - –ö–Ω–æ–ø–∫–∞ Send –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **‚ùå FAIL** - Messages container –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- Sender –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ Conversation (src/components/Conversation/index.js:19-23)
- sendMessage –≤—ã–∑—ã–≤–∞–µ—Ç emitUserMessage —á–µ—Ä–µ–∑ Redux (src/store/actions.js:16)
- BotUtteranceHandler –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã (src/handlers/BotUtteranceHandler.js)

#### ‚úÖ 5. –†—É—á–Ω–æ–π —Ä–µ—Ñ—Ä–µ—à —Å–µ—Å—Å–∏–∏ (2 —Ç–µ—Å—Ç–∞ - 1 –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- **‚úÖ PASS** - Header –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –∫–Ω–æ–ø–∫–∞–º–∏
- **‚ùå FAIL** - RefreshPopup –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- RefreshPopup —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ useState –≤ Conversation (src/components/Conversation/index.js:12)
- refreshSession –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É /restart (src/components/Widget/index.js:175-200)
- showRefreshButton = !props.onAuthButtonClick (src/components/Conversation/index.js:45)

#### ‚úÖ 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ—Ä–µ—à —Ç–æ–∫–µ–Ω–∞ (4 —Ç–µ—Å—Ç–∞ - 3 –ø—Ä–æ—Ö–æ–¥—è—Ç)
- **‚úÖ PASS** - TokenManager —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **‚ùå FAIL** - localStorage –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
- **‚úÖ PASS** - –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è auth screen
- **‚úÖ PASS** - Socket –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

**–†–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- TokenManager.onTokenRefreshed –≤—ã–∑—ã–≤–∞–µ—Ç reconnectSocketWithNewToken (src/index.js:76-78)
- OAuthManager —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º auth (src/services/OAuthManager.js)
- scheduleTokenRefresh –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (src/index.js:107-111)

#### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (3 —Ç–µ—Å—Ç–∞ - 2 –ø—Ä–æ—Ö–æ–¥—è—Ç)
- **‚úÖ PASS** - Widget —Ä–∞–±–æ—Ç–∞–µ—Ç —Å custom props
- **‚úÖ PASS** - Embedded mode —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **‚ùå FAIL** - localStorage —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ
npm test __tests__/integration

# –° –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
npm test -- --verbose
```

## üéì –ì–ª–∞–≤–Ω—ã–π —É—Ä–æ–∫

**–í—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–æ–≤!**

–ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ—Å—Ç–æ–≤ –±—ã–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è—Ö - –ø—Ä–∏–≤–µ–ª–∞ –∫ 26 failing —Ç–µ—Å—Ç–æ–≤.
–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ - 11 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

---

**–ò—Ç–æ–≥–æ**: –°–æ–∑–¥–∞–Ω–∞ —Ä–∞–±–æ—á–∞—è –±–∞–∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è –≤—Å–µ 6 —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
