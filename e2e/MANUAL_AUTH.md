# üéØ –†—É—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ E2E —Ç–µ—Å—Ç–∞—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

OAuth popup —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google/JetBrains –∞–∫–∫–∞—É–Ω—Ç, –Ω–æ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞—Ö.

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### üî• –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: Persistent Auth (–∞–≤—Ç–æ—Ä–∏–∑—É–π—Å—è –æ–¥–∏–Ω —Ä–∞–∑!)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ üò§

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–∏ —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π!

#### –®–∞–≥ 1: –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è –ü–ï–†–í–´–ô –†–ê–ó (—Å–æ—Ö—Ä–∞–Ω–∏ —Å–µ—Å—Å–∏—é)

```bash
npx playwright test --headed -g "–ü–ï–†–í–´–ô –†–ê–ó"
```

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:
1. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä
2. Popup –¥–ª—è OAuth
3. **–ê–≤—Ç–æ—Ä–∏–∑—É–µ—à—å—Å—è –≤—Ä—É—á–Ω—É—é** (–æ–¥–∏–Ω —Ä–∞–∑!)
4. –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `e2e/.auth/user.json` üíæ
5. –ì–æ—Ç–æ–≤–æ!

#### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫–∞–π —Ç–µ—Å—Ç—ã –ë–ï–ó –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚ö°

```bash
# –¢–µ–ø–µ—Ä—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è!
npx playwright test --headed -g "—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π"
```

Playwright –∑–∞–≥—Ä—É–∑–∏—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ cookies/localStorage - —Ç—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω! üéâ

#### –°–±—Ä–æ—Å —Å–µ—Å—Å–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
rm e2e/.auth/user.json
```

---

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Headed Mode (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–π —Ä–∞–∑)

Playwright –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å **–≤–∏–¥–∏–º—ã–π –±—Ä–∞—É–∑–µ—Ä**, –≥–¥–µ —Ç—ã –∞–≤—Ç–æ—Ä–∏–∑—É–µ—à—å—Å—è **–≤—Ä—É—á–Ω—É—é**, –∞ —Ç–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: Headed Mode (–ø—Ä–æ—Å—Ç–æ–π)

```bash
# –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ
npm run test:e2e:headed
```

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:
1. –û—Ç–∫—Ä–æ–µ—Ç—Å—è Chrome –±—Ä–∞—É–∑–µ—Ä (–≤–∏–¥–∏–º—ã–π)
2. –¢–µ—Å—Ç –æ—Ç–∫—Ä–æ–µ—Ç –≤–∏–¥–∂–µ—Ç –∏ –∫–ª–∏–∫–Ω–µ—Ç –Ω–∞ "Authorize"
3. **Popup –æ—Ç–∫—Ä–æ–µ—Ç—Å—è - –∞–≤—Ç–æ—Ä–∏–∑—É–π—Å—è –≤—Ä—É—á–Ω—É—é!**
4. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ popup –∑–∞–∫—Ä–æ–µ—Ç—Å—è
5. –¢–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: Headed + SlowMo (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, —É–¥–æ–±–Ω–µ–µ)

```bash
# –¢–µ—Å—Ç –∏–¥—ë—Ç –º–µ–¥–ª–µ–Ω–Ω–æ - —É—Å–ø–µ–µ—à—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
npx playwright test --headed --slow-mo=2000 e2e/tests/widget-auth.spec.js
```

`--slow-mo=2000` = –∫–∞–∂–¥—ã–π —à–∞–≥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2 —Å–µ–∫—É–Ω–¥—ã

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç —Ä—É—á–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç "–¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –í–†–£–ß–ù–£–Æ"
npx playwright test --headed -g "–¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –í–†–£–ß–ù–£–Æ"
```

## üìù –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ç–µ—Å—Ç–µ

1. –ó–∞–ø—É—Å—Ç–∏ –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –≤—ã—à–µ
2. –î–æ–∂–¥–∏—Å—å –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è **popup –æ–∫–Ω–æ** —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
3. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è —á–µ—Ä–µ–∑ —Å–≤–æ–π Google/JetBrains –∞–∫–∫–∞—É–Ω—Ç**
4. Popup –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –¢–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ:
   - –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ localStorage
   - –ß–∞—Ç —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω
   - Input –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—è–≤–∏–ª—Å—è

## üé¨ –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```bash
$ npm run test:e2e:headed

Running 1 test using 1 worker

[chromium] ‚Ä∫ e2e/tests/widget-auth.spec.js:136:3 ‚Ä∫ Manual OAuth Testing ‚Ä∫ –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –í–†–£–ß–ù–£–Æ

üîê –°–µ–π—á–∞—Å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è popup –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...
‚úÖ Popup –æ—Ç–∫—Ä—ã–ª—Å—è: https://active.jetprofile-stgn.intellij.net/login?...
============================================================
üëâ –ê–í–¢–û–†–ò–ó–£–ô–°–Ø –í–†–£–ß–ù–£–Æ –í POPUP –û–ö–ù–ï!
üëâ –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ popup –∑–∞–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
üëâ –¢–µ—Å—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è...
============================================================

[... —Ç—ã –∞–≤—Ç–æ—Ä–∏–∑—É–µ—à—å—Å—è –≤ popup ...]

‚úÖ Popup –∑–∞–∫—Ä—ã–ª—Å—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω...
‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω: eyJhbGciOiJIUzI1NiIsIn...
‚úÖ –ß–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!

  1 passed (45.2s)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –£–≤–µ–ª–∏—á–∏—Ç—å timeout (–µ—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—à—å—Å—è)

–í —Ç–µ—Å—Ç–µ —É–∂–µ —Å—Ç–æ–∏—Ç 5 –º–∏–Ω—É—Ç:

```javascript
await popup.waitForEvent('close', { timeout: 300000 }); // 5 –º–∏–Ω—É—Ç
```

–ú–æ–∂–µ—à—å —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 10 –º–∏–Ω—É—Ç:

```javascript
await popup.waitForEvent('close', { timeout: 600000 }); // 10 –º–∏–Ω—É—Ç
```

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∫–æ–≥–¥–∞:**
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ backend API –¥–ª—è test token
- –•–æ—á–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π OAuth flow
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞/–¥–µ–±–∞–≥
- –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç

‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:**
- CI/CD pipeline (—Ç–∞–º –Ω–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –ú–∞—Å—Å–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

## üí° Best Practice

–î–ª—è **–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤** –∏—Å–ø–æ–ª—å–∑—É–π API token –ø–æ–¥—Ö–æ–¥:

```javascript
test.beforeEach(async ({ page }) => {
  await createAuthenticatedSession(page);
});
```

–ê **headed mode** –æ—Å—Ç–∞–≤—å –¥–ª—è:
- –î–µ–±–∞–≥ OAuth –ø—Ä–æ–±–ª–µ–º
- –†–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –≤–∏–¥–∂–µ—Ç–∞

## üîß Troubleshooting

### Popup –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω
lsof -i :8080

# –ó–∞–ø—É—Å—Ç–∏ dev server –æ—Ç–¥–µ–ª—å–Ω–æ
npm run stage

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run test:e2e:headed
```

### –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ

```bash
# –î–æ–±–∞–≤—å --slow-mo
npx playwright test --headed --slow-mo=5000
```

### –•–æ—á—É –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```bash
# Debug —Ä–µ–∂–∏–º - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
npm run test:e2e:debug
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è **Playwright Inspector** –≥–¥–µ –º–æ–∂–Ω–æ:
- –ü–æ—à–∞–≥–æ–≤–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–µ—Å—Ç (Step Over)
- –í–∏–¥–µ—Ç—å DOM –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ú–µ–Ω—è—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –ª–µ—Ç—É

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### UI Mode (—Å–∞–º—ã–π —É–¥–æ–±–Ω—ã–π)

```bash
npm run test:e2e:ui
```

–≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–¥–µ:
- –í–∏–¥–∏—à—å –≤—Å–µ —Ç–µ—Å—Ç—ã
- –ó–∞–ø—É—Å–∫–∞–µ—à—å –ø–æ –æ–¥–Ω–æ–º—É
- –°–º–æ—Ç—Ä–∏—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—à—å —É–ø–∞–≤—à–∏–µ

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!** üöÄ
